"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.Contracts = void 0;
/*

    Copyright 2019 dYdX Trading Inc.

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

*/
const bignumber_js_1 = __importDefault(require("bignumber.js"));
const lodash_1 = __importDefault(require("lodash"));
const fact_registry_abi_json_1 = __importDefault(require("../contracts/fact-registry-abi.json"));
const mintable_token_abi_json_1 = __importDefault(require("../contracts/mintable-token-abi.json"));
const proxy_deposit_abi_json_1 = __importDefault(require("../contracts/proxy-deposit-abi.json"));
const starkware_perpetual_abi_json_1 = __importDefault(require("../contracts/starkware-perpetual-abi.json"));
const usdc_abi_json_1 = __importDefault(require("../contracts/usdc-abi.json"));
// Contracts
const types_1 = require("../types");
const helpers_1 = require("./helpers");
class Contracts {
    constructor(provider, networkId, web3, sendOptions = {}) {
        this.contractsList = [];
        this.web3 = web3;
        this.defaultOptions = {
            gas: null,
            gasPrice: undefined,
            value: 0,
            from: null,
            confirmations: 0,
            confirmationType: types_1.ConfirmationType.Confirmed,
            gasMultiplier: 1.5,
            ...sendOptions,
        };
        this.networkId = networkId;
        // Contracts
        this.factRegistry = this.addContract(fact_registry_abi_json_1.default);
        this.starkwarePerpetual = this.addContract(starkware_perpetual_abi_json_1.default);
        this.collateralToken = this.addContract(usdc_abi_json_1.default);
        this.mintableToken = this.addContract(mintable_token_abi_json_1.default);
        this.proxyDepositContract = this.addContract(proxy_deposit_abi_json_1.default);
        this.setProvider(provider, networkId);
        this.setDefaultAccount(this.web3.eth.defaultAccount);
    }
    setProvider(provider, networkId) {
        this.networkId = networkId;
        this.contractsList.forEach((contract) => this.setContractProvider(contract.contract, contract.json, provider, networkId));
    }
    setDefaultAccount(account) {
        this.contractsList.forEach((contract) => {
            contract.contract.options.from = account;
        });
    }
    async call(method, specificOptions = {}) {
        const { blockNumber, ...otherOptions } = this.toCallOptions({
            ...this.defaultOptions,
            ...specificOptions,
        });
        return method.call(otherOptions, blockNumber || 'latest');
    }
    async send(contract, method, specificOptions = {}) {
        const sendOptions = {
            ...this.defaultOptions,
            ...specificOptions,
        };
        const result = await this._send(contract, method, sendOptions);
        return result;
    }
    // ============ Helper Functions ============
    addContract(json, isTest = false) {
        const contract = new this.web3.eth.Contract(json.abi);
        this.contractsList.push({ contract, json, isTest });
        return contract;
    }
    setContractProvider(contract, contractJson, provider, networkId) {
        contract.setProvider(provider);
        // Use market-specific info if available, and fall back to non-market-specific info.
        const deployedInfo = contractJson.networks[networkId];
        contract.options.address = deployedInfo && deployedInfo.address;
    }
    async _send(// tslint:disable-line:function-name
    contract, method, sendOptions = {}) {
        const { confirmations, confirmationType, gasMultiplier, ...txOptions } = sendOptions;
        if (confirmationType && !Object.values(types_1.ConfirmationType).includes(confirmationType)) {
            throw new Error(`Invalid confirmation type: ${confirmationType}`);
        }
        if (confirmationType === types_1.ConfirmationType.Simulate || !txOptions.gas) {
            const gasEstimate = await this.estimateGas(method, txOptions);
            txOptions.gas = Math.floor(gasEstimate * gasMultiplier);
            if (confirmationType === types_1.ConfirmationType.Simulate) {
                return {
                    gasEstimate,
                    gas: txOptions.gas,
                };
            }
        }
        let hashOutcome = helpers_1.OUTCOMES.INITIAL;
        let confirmationOutcome = helpers_1.OUTCOMES.INITIAL;
        if (confirmationType === types_1.ConfirmationType.Sender) {
            const data = method.encodeABI();
            const from = txOptions.from || this.web3.defaultAccount;
            if (from === null) {
                throw new Error('Cannot sendTransaction with from=null');
            }
            if (lodash_1.default.isNil(txOptions.nonce)) {
                throw new Error('Cannot sendTransaction with nonce=null');
            }
            const nonceIsHexString = (typeof txOptions.nonce === 'string') &&
                txOptions.nonce.includes('0x');
            const nonceBn = new bignumber_js_1.default(txOptions.nonce, nonceIsHexString ? 16 : 10);
            const stPromi = this.web3.eth.sendTransaction({
                gas: txOptions.gas,
                value: txOptions.value,
                gasPrice: txOptions.gasPrice,
                to: contract.options.address,
                from,
                nonce: nonceBn.toNumber(),
                data,
            });
            const stPromise = new Promise((resolve, reject) => {
                stPromi.on('error', (error) => {
                    if (hashOutcome === helpers_1.OUTCOMES.INITIAL) {
                        hashOutcome = helpers_1.OUTCOMES.REJECTED;
                        reject(error);
                        stPromi.off();
                    }
                });
                stPromi.on('transactionHash', (txHash) => {
                    if (hashOutcome === helpers_1.OUTCOMES.INITIAL) {
                        hashOutcome = helpers_1.OUTCOMES.RESOLVED;
                        resolve(txHash);
                        stPromi.off();
                    }
                });
            });
            const stResult = await stPromise;
            return (0, helpers_1.normalizeResponse)({ transactionHash: stResult });
        }
        const promi = method.send(this.toNativeSendOptions(txOptions));
        let transactionHash;
        let hashPromise;
        let confirmationPromise;
        if (confirmationType && [
            types_1.ConfirmationType.Hash,
            types_1.ConfirmationType.Both,
        ].includes(confirmationType)) {
            hashPromise = new Promise((resolve, reject) => {
                promi.on('error', (error) => {
                    if (hashOutcome === helpers_1.OUTCOMES.INITIAL) {
                        hashOutcome = helpers_1.OUTCOMES.REJECTED;
                        reject(error);
                        promi.off();
                    }
                });
                promi.on('transactionHash', (txHash) => {
                    if (hashOutcome === helpers_1.OUTCOMES.INITIAL) {
                        hashOutcome = helpers_1.OUTCOMES.RESOLVED;
                        resolve(txHash);
                        if (confirmationType !== types_1.ConfirmationType.Both) {
                            promi.off();
                        }
                    }
                });
            });
            transactionHash = await hashPromise;
        }
        if (confirmationType && [
            types_1.ConfirmationType.Confirmed,
            types_1.ConfirmationType.Both,
        ].includes(confirmationType)) {
            confirmationPromise = new Promise((resolve, reject) => {
                promi.on('error', (error) => {
                    if (confirmationOutcome === helpers_1.OUTCOMES.INITIAL &&
                        (confirmationType === types_1.ConfirmationType.Confirmed ||
                            hashOutcome === helpers_1.OUTCOMES.RESOLVED)) {
                        confirmationOutcome = helpers_1.OUTCOMES.REJECTED;
                        reject(error);
                        promi.off();
                    }
                });
                if (confirmations) {
                    promi.on('confirmation', (confNumber, receipt) => {
                        if (confNumber >= confirmations) {
                            if (confirmationOutcome === helpers_1.OUTCOMES.INITIAL) {
                                confirmationOutcome = helpers_1.OUTCOMES.RESOLVED;
                                resolve(receipt);
                                promi.off();
                            }
                        }
                    });
                }
                else {
                    promi.on('receipt', (receipt) => {
                        confirmationOutcome = helpers_1.OUTCOMES.RESOLVED;
                        resolve(receipt);
                        promi.off();
                    });
                }
            });
        }
        if (confirmationType === types_1.ConfirmationType.Hash) {
            return (0, helpers_1.normalizeResponse)({ transactionHash });
        }
        if (confirmationType === types_1.ConfirmationType.Confirmed) {
            return confirmationPromise;
        }
        return (0, helpers_1.normalizeResponse)({
            transactionHash,
            confirmation: confirmationPromise,
        });
    }
    async estimateGas(method, txOptions) {
        const estimateOptions = this.toEstimateOptions(txOptions);
        try {
            const gasEstimate = await method.estimateGas(estimateOptions);
            return gasEstimate;
        }
        catch (error) {
            error.transactionData = {
                ...estimateOptions,
                data: method.encodeABI(),
                to: method._parent._address,
            };
            throw error;
        }
    }
    // ============ Parse Options ============
    toEstimateOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
        ]);
    }
    toCallOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
            'blockNumber',
        ]);
    }
    toNativeSendOptions(options) {
        return lodash_1.default.pick(options, [
            'from',
            'value',
            'gasPrice',
            'gas',
            'nonce',
        ]);
    }
}
exports.Contracts = Contracts;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29udHJhY3RzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9Db250cmFjdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7RUFnQkU7QUFDRixnRUFBcUM7QUFDckMsb0RBQXVCO0FBYXZCLGlHQUFrRTtBQUNsRSxtR0FBb0U7QUFDcEUsaUdBQWtFO0FBQ2xFLDZHQUE4RTtBQUM5RSwrRUFBaUQ7QUFDakQsWUFBWTtBQUNaLG9DQVFrQjtBQUNsQix1Q0FBd0Q7QUFheEQsTUFBYSxTQUFTO0lBWXBCLFlBQ0UsUUFBa0IsRUFDbEIsU0FBaUIsRUFDakIsSUFBVSxFQUNWLGNBQTJCLEVBQUU7UUFYeEIsa0JBQWEsR0FBbUIsRUFBRSxDQUFDO1FBYXhDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxjQUFjLEdBQUc7WUFDcEIsR0FBRyxFQUFFLElBQUk7WUFDVCxRQUFRLEVBQUUsU0FBUztZQUNuQixLQUFLLEVBQUUsQ0FBQztZQUNSLElBQUksRUFBRSxJQUFJO1lBQ1YsYUFBYSxFQUFFLENBQUM7WUFDaEIsZ0JBQWdCLEVBQUUsd0JBQWdCLENBQUMsU0FBUztZQUM1QyxhQUFhLEVBQUUsR0FBRztZQUNsQixHQUFHLFdBQVc7U0FDZixDQUFDO1FBRUYsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFFM0IsWUFBWTtRQUNaLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxnQ0FBZSxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsc0NBQXFCLENBQUMsQ0FBQztRQUNsRSxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsdUJBQU8sQ0FBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FB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